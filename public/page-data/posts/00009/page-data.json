{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/00009","result":{"data":{"markdownRemark":{"id":"15b769a2-9b3f-58cd-bf2d-bee7ffd68876","html":"<h2 id=\"導入\" style=\"position:relative;\"><a href=\"#%E5%B0%8E%E5%85%A5\" aria-label=\"導入 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>導入</h2>\n<p>本記事では、Azure AD B2Cのユーザーフローを使い、メールアドレスアカウントでの認証処理を開発していきます。</p>\n<h2 id=\"目次\" style=\"position:relative;\"><a href=\"#%E7%9B%AE%E6%AC%A1\" aria-label=\"目次 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>目次</h2>\n<ol>\n<li>ユーザーフローとは</li>\n<li>事前準備</li>\n<li>\n<p>アプリの設定</p>\n<ol>\n<li>アプリケーションの登録</li>\n<li>暗黙の付与を許可する</li>\n</ol>\n</li>\n<li>ユーザーフローの作成</li>\n<li>ユーザーフローの実行</li>\n</ol>\n<h2 id=\"ユーザーフローとは\" style=\"position:relative;\"><a href=\"#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%83%95%E3%83%AD%E3%83%BC%E3%81%A8%E3%81%AF\" aria-label=\"ユーザーフローとは permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ユーザーフローとは</h2>\n<p>ユーザーフローとは、AzureADB2Cにデフォルトで用意されている認証機能の雛形のことです。<br>\nこれをベースに画面UIや言語、連携データなどの情報をGUIでカスタムしていくことができます。<br>\n用意されているユーザーフローは大きく３種類です。  </p>\n<ul>\n<li>サインアップとサインイン（新規登録とログインができます）</li>\n<li>プロファイルの編集（ユーザー情報の編集ができます）</li>\n<li>パスワードリセット（パスワードの変更ができます）<br>\n※他にもありますが、旧バージョンのフローになります</li>\n</ul>\n<p>今回はサインアップとサインインを作成し、ログインできるところまで確認していきます。  </p>\n<h2 id=\"事前準備\" style=\"position:relative;\"><a href=\"#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99\" aria-label=\"事前準備 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>事前準備</h2>\n<p>AzureADB2Cのテナントが作成されている必要があります。<br>\nテナントの作成方法については<a href=\"/posts/00008\">こちら</a>を参照してください。  </p>\n<h2 id=\"アプリの設定\" style=\"position:relative;\"><a href=\"#%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AE%E8%A8%AD%E5%AE%9A\" aria-label=\"アプリの設定 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>アプリの設定</h2>\n<h3 id=\"アプリケーションの登録\" style=\"position:relative;\"><a href=\"#%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E7%99%BB%E9%8C%B2\" aria-label=\"アプリケーションの登録 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>アプリケーションの登録</h3>\n<p>左のナビゲーションメニューから「アプリの登録」を押下します。<br>\n<img src=\"../media/00009/ScreenShot%202020-09-13%2014.09.14.png\" alt=\"ScreenShot 2020-09-13 14.09.14.png\"></p>\n<p>「新規登録」を押下し、アプリの情報を入力していきます。<br>\n以下の通り入力したら「登録」を押下します。  </p>\n<ul>\n<li>アプリ名：sample-express-app（任意の値で大丈夫です）  </li>\n<li>サポートされているアカウントの種類：任意の組織ディレクトリ内のアカウントまたは任意の ID プロバイダー。Azure AD B2C でユーザーを認証します。  </li>\n<li>リダイレクトURI：<code class=\"language-text\">https://jwt.ms/</code> を設定  </li>\n<li>アクセス許可：チェックを入れます  </li>\n</ul>\n<p><img src=\"../media/00009/screencapture-portal-azure-2020-09-13-14_14_33.png\" alt=\"screencapture-portal-azure-2020-09-13-14_14_33.png\"></p>\n<p>これでアプリが登録されました。<br>\n<img src=\"../media/00009/ScreenShot%202020-09-13%2014.20.40.png\" alt=\"ScreenShot 2020-09-13 14.20.40.png\"></p>\n<h3 id=\"暗黙の付与を許可する\" style=\"position:relative;\"><a href=\"#%E6%9A%97%E9%BB%99%E3%81%AE%E4%BB%98%E4%B8%8E%E3%82%92%E8%A8%B1%E5%8F%AF%E3%81%99%E3%82%8B\" aria-label=\"暗黙の付与を許可する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>暗黙の付与を許可する</h3>\n<p>認証タブを押下し、画面の真ん中あたりに暗黙の付与という項目があります。<br>\n<img src=\"../media/00009/ScreenShot%202020-09-13%2015.13.16.png\" alt=\"ScreenShot 2020-09-13 15.13.16.png\"></p>\n<p>これはOAuth2.0におけるインプリシットフローを許可するか、という設定なのですが、詳細はここでは理解していなくて大丈夫です。<br>\nこれの「IDトークン」と「アクセストークン」にチェックを入れ、「保存」を押下します。<br>\n※ここのチェックを入れておくことで、以降のユーザーフローを実行したときにトークンの中身を確認することができます。</p>\n<h2 id=\"ユーザーフローの作成\" style=\"position:relative;\"><a href=\"#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%83%95%E3%83%AD%E3%83%BC%E3%81%AE%E4%BD%9C%E6%88%90\" aria-label=\"ユーザーフローの作成 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ユーザーフローの作成</h2>\n<p>左のナビゲーションメニューから「ユーザーフロー」を押下します。<br>\n「新しいユーザーフロー」を押下します。\n<img src=\"../media/00009/ScreenShot%202020-09-13%2014.23.59.png\" alt=\"ScreenShot 2020-09-13 14.23.59.png\"></p>\n<p>「サインアップとサインイン」を選択します。<br>\nバージョン設定はデフォルトのままで、「作成」を押下します。\n<img src=\"../media/00009/ScreenShot%202020-09-13%2014.24.25.png\" alt=\"ScreenShot 2020-09-13 14.24.25.png\"></p>\n<p>ユーザーフローの設定をしていきます。<br>\nここでは以下のように入力しています。  </p>\n<ul>\n<li>ユーザーフロー名：B2C<em>1</em>SampleSignUpSignIn</li>\n<li>IDプロバイダー：Email signup にチェック</li>\n<li>多要素認証：デフォルトのまま</li>\n<li>条件付きアクセス：「条件付きアクセス ポリシーを適用する」のチェックを外す（チェックが入っているとMFAが有効になり、課金される可能性があります）</li>\n<li>ユーザー情報とトークン要求：ここでは、性と名について、属性を収集すると要求を返すにチェックを入れています（任意）\n<img src=\"../media/00009/ScreenShot%202020-09-13%2014.33.24.png\" alt=\"ScreenShot 2020-09-13 14.33.24.png\">\n<img src=\"../media/00009/ScreenShot%202020-09-13%2014.33.33.png\" alt=\"ScreenShot 2020-09-13 14.33.33.png\"></li>\n</ul>\n<p>作成が完了すると、一覧部分に表示されるようになります。\n<img src=\"../media/00009/ScreenShot%202020-09-13%2014.34.16.png\" alt=\"ScreenShot 2020-09-13 14.34.16.png\"></p>\n<h2 id=\"ユーザーフローの実行\" style=\"position:relative;\"><a href=\"#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%83%95%E3%83%AD%E3%83%BC%E3%81%AE%E5%AE%9F%E8%A1%8C\" aria-label=\"ユーザーフローの実行 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ユーザーフローの実行</h2>\n<p>B2C<em>1</em>SampleSignUpSignInを選択します。\n<img src=\"../media/00009/ScreenShot%202020-09-13%2014.40.13.png\" alt=\"ScreenShot 2020-09-13 14.40.13.png\"></p>\n<p>「ユーザーフローを実行する」を押下すると、右側に以下の画面が表示されるかと思います。<br>\nここではデフォルトで先ほど作成したアプリケーションと応答URLが表示されています。<br>\nデフォルトのままで大丈夫ですので、「ユーザーフローを実行します」を押下します。\n<img src=\"../media/00009/ScreenShot%202020-09-13%2014.41.11.png\" alt=\"ScreenShot 2020-09-13 14.41.11.png\"></p>\n<p>別タブで以下の画面が開きます。\n<img src=\"../media/00009/ScreenShot%202020-09-13%2014.45.50.png\" alt=\"ScreenShot 2020-09-13 14.45.50.png\"></p>\n<p>URLをみると以下のようになっています。<br>\nここではパラメータの説明は省略します。  </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">https://<span class=\"token punctuation\">{</span>テナント名<span class=\"token punctuation\">}</span>.b2clogin.com/<span class=\"token punctuation\">{</span>テナント名<span class=\"token punctuation\">}</span>.onmicrosoft.com/oauth2/v2.0/authorize\n?p<span class=\"token operator\">=</span>B2C_1_SampleSignUpSignIn\n<span class=\"token operator\">&amp;</span><span class=\"token assign-left variable\">client_id</span><span class=\"token operator\">=</span>ae0b7503-a335-43a1-8776-e1707cca3930\n<span class=\"token operator\">&amp;</span><span class=\"token assign-left variable\">nonce</span><span class=\"token operator\">=</span>defaultNonce\n<span class=\"token operator\">&amp;</span><span class=\"token assign-left variable\">redirect_uri</span><span class=\"token operator\">=</span>https%3A%2F%2Fjwt.ms%2F\n<span class=\"token operator\">&amp;</span><span class=\"token assign-left variable\">scope</span><span class=\"token operator\">=</span>openid\n<span class=\"token operator\">&amp;</span><span class=\"token assign-left variable\">response_type</span><span class=\"token operator\">=</span>code\n<span class=\"token operator\">&amp;</span><span class=\"token assign-left variable\">prompt</span><span class=\"token operator\">=</span>login</code></pre></div>\n<p>認証機能をテストしていきますが、テスト用のアカウントが未作成かと思いますので、「Sign up now」を選択します。<br>\n<img src=\"../media/00009/ScreenShot%202020-09-13%2014.56.31.png\" alt=\"ScreenShot 2020-09-13 14.56.31.png\"></p>\n<p>メールアドレスを入力して「Send verification code」を押下すると、確認コードが届きます。<br>\nコードを入力し、「Verify code」を押下すると認証完了です。<br>\nパスワードと姓名の情報を入力し、createを押下します。<br>\n<img src=\"../media/00009/ScreenShot%202020-09-13%2014.59.58.png\" alt=\"ScreenShot 2020-09-13 14.59.58.png\"></p>\n<p>以下のように<code class=\"language-text\">https://jwt.ms/</code>の画面が表示されていれば認証成功です。<br>\n<img src=\"../media/00009/ScreenShot%202020-09-13%2015.15.11.png\" alt=\"ScreenShot 2020-09-13 15.15.11.png\"></p>\n<p>URLを見てみると<code class=\"language-text\">id_token=eyJ0eX・・・</code>とあるかと思います。<br>\nこれはIDトークンというAzureADB2Cで認証したことを証明する情報です。<br>\nこのサイトではURL部分にトークン情報が含まれていると、その情報を画面に表示する仕様となっています。<br>\n※ここではトークンの詳細な説明は省略します。  </p>\n<p>以上でユーザーフローを使った認証処理は完了です。  </p>","fields":{"slug":"/posts/00009","tagSlugs":["/tag/プログラミング学習/","/tag/プログラミング初心者/"]},"frontmatter":{"date":"2020-09-13","description":"本記事では、Azure AD B2Cのユーザーフローを使い方を解説します","tags":["プログラミング学習","プログラミング初心者"],"title":"【Azure AD B2C】ユーザーフローでメールアドレスログインを行う","socialImage":null}}},"pageContext":{"slug":"/posts/00009"}},"staticQueryHashes":["251939775","3159585216","3942705351","401334301"]}