{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/00014","result":{"data":{"markdownRemark":{"id":"0a70af9c-8772-515b-9ea6-f47ec4142dff","html":"<h2 id=\"導入\" style=\"position:relative;\"><a href=\"#%E5%B0%8E%E5%85%A5\" aria-label=\"導入 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>導入</h2>\n<p>本記事では、Azureが提供しているAPI Managementサービスの従量課金プランを使用してみたので、その感想をまとめたいと思います。</p>\n<h2 id=\"目次\" style=\"position:relative;\"><a href=\"#%E7%9B%AE%E6%AC%A1\" aria-label=\"目次 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>目次</h2>\n<ol>\n<li>Azure API Managementサービスとは</li>\n<li>料金体型</li>\n<li>インスタンスの作成</li>\n<li>APIのインポート</li>\n<li>APIをテストする</li>\n<li>終わりに</li>\n</ol>\n<h2 id=\"azure-api-managementサービスとは\" style=\"position:relative;\"><a href=\"#azure-api-management%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%A8%E3%81%AF\" aria-label=\"azure api managementサービスとは permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Azure API Managementサービスとは</h2>\n<p>以下の記述が簡潔でわかりやすかったので引用します。  </p>\n<blockquote>\n<p>Azure API Management は、Azure が提供するマネージドな API ゲートウェイのサービスで、バックエンドにあるサービスを提供する API を一括で管理して様々な処理 (セキュリティ、レート制限、データ変換、監視、など) を仲介するものです。<br>\n引用元：<a href=\"https://qiita.com/tetsuya-ooooo/items/3cd4d3d4c7fc1d180cda\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Azure API Management の解説とハンズオンの復習</a></p>\n</blockquote>\n<h2 id=\"料金体型\" style=\"position:relative;\"><a href=\"#%E6%96%99%E9%87%91%E4%BD%93%E5%9E%8B\" aria-label=\"料金体型 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>料金体型</h2>\n<p>詳細は<a href=\"https://azure.microsoft.com/ja-jp/pricing/details/api-management/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">こちら</a>を参照してください。  </p>\n<p>プランは大きく分けて、使用量に応じた従量課金プランと、単位時間あたりの使用量に応じたプランの２種類に分類できます。<br>\n従量課金プランは機能は大きく制限されますが、100万リクエスト/月 まで無料で使えます。<br>\n個人の検証用には十分ですので、こちらを使っていきます。<br>\n※「使用量」という謎の翻訳になっていますが、「従量課金」プランを指しています。  </p>\n<p><img src=\"../media/00014/ScreenShot%202020-09-19%2014.34.00.png\" alt=\"ScreenShot 2020-09-19 14.34.00.png\"></p>\n<h2 id=\"インスタンスの作成\" style=\"position:relative;\"><a href=\"#%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AE%E4%BD%9C%E6%88%90\" aria-label=\"インスタンスの作成 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>インスタンスの作成</h2>\n<p><a href=\"https://docs.microsoft.com/ja-jp/azure/api-management/get-started-create-service-instance\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">公式ドキュメント</a>をベースに手順を説明いたします。<br>\n※developerプランの前提で書かれているので、従量課金プランに置き換えていきます</p>\n<p>Azure portal メニューから [リソースの作成] -> API Management を検索 -> [API管理] を選択します。<br>\n<img src=\"../media/00014/ScreenShot%202020-09-19%2011.44.49.png\" alt=\"ScreenShot 2020-09-19 11.44.49.png\"></p>\n<p>[API Management サービス] 画面で設定を入力します。<br>\n<img src=\"../media/00014/ScreenShot%202020-09-19%2011.59.36.png\" alt=\"ScreenShot 2020-09-19 11.59.36.png\"></p>\n<ul>\n<li>東日本リージョンでは従量課金プランを選択できないので、東アジアリージョンを選択</li>\n<li>価格レベルを見ると「消費」とありますが、「consumption」の略で、これが従量課金プランを指していると思われます。この辺りちゃんとして欲しいですね・・・</li>\n</ul>\n<p>[作成] 押下後、ポータルの通知部分にデプロイ中の旨が表示されます。<br>\n<img src=\"../media/00014/ScreenShot%202020-09-19%2012.00.33.png\" alt=\"ScreenShot 2020-09-19 12.00.33.png\"></p>\n<p>数分待つとデプロイが完了しました。<br>\n※公式ドキュメントの手順はdeveloperプランで20~30分かかると記載がありましたが、従量課金プランは速いのでしょうか？笑\n<img src=\"../media/00014/ScreenShot%202020-09-19%2012.03.45.png\" alt=\"ScreenShot 2020-09-19 12.03.45.png\"></p>\n<p>検索フォームからAPI Maagementサービスを検索すると、先ほどのリソースが作成されていることがわかります。<br>\n<img src=\"../media/00014/ScreenShot%202020-09-19%2012.05.02.png\" alt=\"ScreenShot 2020-09-19 12.05.02.png\"></p>\n<p>サービスの詳細を確認します。<br>\n<img src=\"../media/00014/ScreenShot%202020-09-19%2012.05.24.png\" alt=\"ScreenShot 2020-09-19 12.05.24.png\"></p>\n<h2 id=\"apiのインポート\" style=\"position:relative;\"><a href=\"#api%E3%81%AE%E3%82%A4%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%88\" aria-label=\"apiのインポート permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>APIのインポート</h2>\n<p>続いてAPIをAzure API Managementにインポートしていきます。<br>\nサンプルとなるAPIはAzureで用意されており、以下URLを叩くと仕様を確認できます。<br>\nこちらを利用していきます。<br>\n<a href=\"https://conferenceapi.azurewebsites.net?format=json\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://conferenceapi.azurewebsites.net?format=json</a>\n<img src=\"../media/00014/ScreenShot%202020-09-19%2012.21.05.png\" alt=\"ScreenShot 2020-09-19 12.21.05.png\"></p>\n<p>左側のナビゲーションの [API Management] -> [API] -> [OpenAPI] タイルを選択し、ポップアップ画面の <a href=\"%E3%83%95%E3%83%AB\">Full</a> を選択します。<br>\n以下の通り入力して [Create] を押下します。<br>\n各項目の説明は<a href=\"https://docs.microsoft.com/ja-jp/azure/api-management/import-and-publish#import-and-publish-a-backend-api\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">公式ドキュメント</a>を参照してください。<br>\n<img src=\"../media/00014/ScreenShot%202020-09-19%2012.25.42.png\" alt=\"ScreenShot 2020-09-19 12.25.42.png\">\n<img src=\"../media/00014/ScreenShot%202020-09-19%2012.33.08.png\" alt=\"ScreenShot 2020-09-19 12.33.08.png\">\nProductについては、従量課金プランだと設定は不要との記事もあったので設定方法が不明でしたが、ドキュメント通り<code class=\"language-text\">Unlimited</code>としました。</p>\n<h2 id=\"apiをテストする\" style=\"position:relative;\"><a href=\"#api%E3%82%92%E3%83%86%E3%82%B9%E3%83%88%E3%81%99%E3%82%8B\" aria-label=\"apiをテストする permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>APIをテストする</h2>\n<p>続いて登録したAPIをテストしてみます。<br>\n左側のナビゲーションの [API Management] -> [API] -> [Demo Conference API] -> [テスト] -> [GetSpeakers] を選択すると、\nGetSpeakers APIの仕様が表示されます。<br>\n<img src=\"../media/00014/ScreenShot%202020-09-19%2012.33.33.png\" alt=\"ScreenShot 2020-09-19 12.33.33.png\">\n<img src=\"../media/00014/ScreenShot%202020-09-19%2012.34.50.png\" alt=\"ScreenShot 2020-09-19 12.34.50.png\"></p>\n<p>HTTP リクエスト部分を抜粋すると</p>\n<div class=\"gatsby-highlight\" data-language=\"md\"><pre class=\"language-md\"><code class=\"language-md\">GET https://{API Managementサービス名}.azure-api.net/conference/speakers HTTP/1.1\nHost: {API Managementサービス名}.azure-api.net\nOcp-Apim-Subscription-Key: *****************************\nOcp-Apim-Trace: true</code></pre></div>\n<p>仕様では<code class=\"language-text\">dayno</code>と<code class=\"language-text\">speakername</code>というクエリパラメータが設定されていますが、とりあえず空のまま利用してみます。<br>\n「Send」を押下します。<br>\n正常終了すれば、以下のような200レスポンスが返却されるかと思います。<br>\n<img src=\"../media/00014/ScreenShot%202020-09-19%2012.35.20.png\" alt=\"ScreenShot 2020-09-19 12.35.20.png\"></p>\n<p>HTTP レスポンスを抜粋すると</p>\n<div class=\"gatsby-highlight\" data-language=\"md\"><pre class=\"language-md\"><code class=\"language-md\">HTTP/1.1 200 OK\n\ncache-control: no-cache\ncontent-length: 40606\ncontent-type: application/vnd.collection+json\ndate: Sat, 19 Sep 2020 03:35:06 GMT\nexpires: -1\nocp-apim-trace-location: https://apimstrvh1epexidsgscyqls.blob.core.windows.net/apimstbowbjbbkitkmaerfbd-inspector/-ju2SS1tie9vHgGnnGc9LA2-1?sv=2018-03-28&amp;sr=c&amp;sig=0yHVqER3qaUFRDHaWycBph1PD%2Fx9pI0UrHDhnDXpmGY%3D&amp;se=2021-09-19T03%3A00%3A49Z&amp;sp=racwdl&amp;traceId=6dfbbf94f14247289c444292b22531e0\npragma: no-cache\nrequest-context: appId=cid-v1:1d21644b-7e61-4c5d-9e16-e5c56dba9811\nvary: Origin\nx-aspnet-version: 4.0.30319\nx-powered-by: ASP.NET\n{\n    \"collection\": {\n        \"version\": \"1.0\",\n        \"href\": \"https://conferenceapi.azurewebsites.net:443/speakers\",\n        \"links\": [],\n        \"items\": [{\n                \"href\": \"https://conferenceapi.azurewebsites.net/speaker/1\",\n                \"data\": [{\n                    \"name\": \"Name\",\n                    \"value\": \"Scott Guthrie\"\n                }],\n                \"links\": [{\n                    \"rel\": \"http://tavis.net/rels/sessions\",\n                    \"href\": \"https://conferenceapi.azurewebsites.net/speaker/1/sessions\"\n                }]\n            },\n            ・\n            ・\n            ・\n        ],\n        \"queries\": [],\n        \"template\": {\n            \"data\": []\n        }\n    }\n}</code></pre></div>\n<h2 id=\"終わりに\" style=\"position:relative;\"><a href=\"#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB\" aria-label=\"終わりに permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>終わりに</h2>\n<p>本日はAzureのAPI Managementサービスについて、サンプルAPIの登録、テスト実行まで行いました。<br>\n従量課金プランでは、100万リクエスト/月まで無料ですので、いろいろ試してみようかと思います。</p>\n<h2 id=\"参考ドキュメント\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88\" aria-label=\"参考ドキュメント permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考ドキュメント</h2>\n<ul>\n<li><a href=\"https://qiita.com/tetsuya-ooooo/items/3cd4d3d4c7fc1d180cda\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Azure API Management の解説とハンズオンの復習</a></li>\n<li><a href=\"https://qiita.com/takashiuesaka/items/11ab38ba4f18f8848c7a\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Azure API Managementの従量課金モデルを軽く調べた＆Az.APIManagementで廃止になったコマンド</a></li>\n</ul>","fields":{"slug":"/posts/00014","tagSlugs":["/tag/プログラミング学習/","/tag/プログラミング初心者/"]},"frontmatter":{"date":"2020-09-19","description":"本記事では、Azureが提供しているAPI Managementサービスの従量課金プランを使用してみたので、その感想をまとめたいと思います。","tags":["プログラミング学習","プログラミング初心者"],"title":"Azure API Managementの従量課金プランを利用してみた","socialImage":null}}},"pageContext":{"slug":"/posts/00014"}},"staticQueryHashes":["251939775","3159585216","3942705351","401334301"]}